{% extends "base.html" %} {% load static %}
<!--load humanize -->
{% load humanize %} {% block title %} | {{listing.title}}{% endblock title %}
<!-- About main content -->
{% block content %}

<!-- Success message alert -->
{% include "partials/_alert.html" %}

<div class="card">
  <div class="card-header">
    {% if listing.company.logo %}
    <img
      class="card-img-top"
      src="{{listing.company.logo}}"
      alt="{{listing.company.name}} Logo" />
    {% endif %}
    <h2>{{listing.title}}</h2>
    <a href="{% url 'companies:company' listing.company.id %}">
      <h6 class="card-subtitle text-muted mb-2">{{listing.company}}
      </h6>
    </a>
    <p class="mb-0">Budget: {{listing.budget}}</p>
    <p>Duration: {{listing.duration}}</p>
  </div>
  <div class="card-body">
    <h5>Description:</h5>
    <p>{{listing.description}}</p>
    <h5>Requirement:</h5>
    <p>{{listing.requirement}}</p>
    <p>Published {{listing.publish_date|timesince}} ago</p>

    {% if is_own_company_listing %}
    <!-- Edit button for Company HR viewing their own company's listing -->
    <button
      type="button"
      class="btn btn-warning"
      data-toggle="modal"
      data-target="#editJobModal">
      Edit Job
    </button>
    {% else %}
      {% if is_company_hr %}
      <!-- Company HR viewing other company's listing - Apply disabled -->
      <button
        type="button"
        class="btn btn-outline-primary disabled"
        title="Apply function is only available for individual users">
        Apply (Company HR Cannot Apply)
      </button>
      {% else %}
      <!-- Apply button for individual users -->
      {% if user.is_authenticated %}
      <a
        href="{% url 'applies:apply' listing.id %}"
        class="btn btn-outline-primary"
        >Apply
      </a>
      {% else %}
      <a
        href="{% url 'accounts:login' %}?next={{ request.path }}"
        class="btn btn-outline-primary disabled"
        title="Please login to apply for jobs"
        >Apply (Login Required)
      </a>
      {% endif %}
      {% endif %}
    {% endif %}
  </div>
</div>



<!-- Edit Job Modal -->
<div
  class="modal fade"
  id="editJobModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="editJobModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editJobModalLabel">
          Edit Job: {{listing.title}}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="editJobForm" method="POST" action="">
          {% csrf_token %}
          <input type="hidden" name="listing_id" value="{{listing.id}}" />
          <div class="form-group">
            <label for="editTitle">Job Title</label>
            <input
              type="text"
              class="form-control"
              id="editTitle"
              name="title"
              value="{{listing.title}}"
              required />
          </div>
          <div class="form-group">
            <label for="editIndustry">Industry</label>
            <select class="form-control" id="editIndustry" name="industry" required>
                <option value="" disabled>Select Industry</option>
                {% for key, value in industry_choices.items %}
                <option value="{{key}}" {% if listing.industry == key %}selected{% endif %}>{{value}}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="editBudget">Budget</label>
            <select class="form-control" id="editBudget" name="budget" required>
                <option value="" disabled>Select Budget</option>
                {% for key, value in budget_choices.items %}
                <option value="{{key}}" {% if listing.budget == key %}selected{% endif %}>{{value}}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="editDuration">Duration</label>
            <select class="form-control" id="editDuration" name="duration" required>
                <option value="" disabled>Select Duration</option>
                {% for key, value in duration_choices.items %}
                <option value="{{key}}" {% if listing.duration == key %}selected{% endif %}>{{value}}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="editRequirement">Requirement</label>
            <textarea
              class="form-control"
              id="editRequirement"
              name="requirement"
              rows="3"
              required>{{listing.requirement}}</textarea>
          </div>
          <div class="form-group">
            <label for="editDescription">Description</label>
            <textarea
              class="form-control"
              id="editDescription"
              name="description"
              rows="5"
              required>{{listing.description}}</textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">
          Cancel
        </button>
        <button type="submit" form="editJobForm" class="btn btn-primary">
          Save Changes
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock content %}

